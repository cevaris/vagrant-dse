#!/bin/bash
echo "Adding authorized_keys to root user"
sudo mkdir -p /root/.ssh/
sudo echo "#{key}" >> /root/.ssh/authorized_keys
echo "Done adding authorized_keys"

echo "Adding authorized_keys to vagrant user"
mkdir -p .ssh/
echo "#{key}" >> .ssh/authorized_keys
echo "Done adding authorized_keys"


echo "Updtaing..."
sudo apt-get update
echo "... done updating"


echo "Installing Java 7"
sudo apt-get install openjdk-7-jdk openjdk-7-jre curl -y
echo "... done installing Java 7"

echo "Adding DSE apt sources"
echo "deb http://<%= credentials['username'] %>:<%= credentials['password'] %>@debian.datastax.com/enterprise stable main" | \
  sudo tee -a /etc/apt/sources.list.d/datastax.sources.list
curl -L https://debian.datastax.com/debian/repo_key | sudo apt-key add -
echo "... done adding DSE apt sources"

echo "Updtaing..."
sudo apt-get update
echo "... done updating"

echo "Installing DSE"
sudo apt-get install dse-full opscenter -y
echo "... done installing DSE"


echo "Script done..."